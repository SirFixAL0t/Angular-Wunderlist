!function(a){"use strict";function l(a,b){b.prototype=Object.create(a.prototype),b.prototype.constructor=b}var b=a.module("ngWunderlistModule",[]),c="https://a.wunderlist.com/api/v1/",d="avatar,files,previews,folders,lists,memberships,notes,list_positions,task_positions,subtask_positions,reminders,root,subtasks,tasks,task_comments,uploads,user,webhooks".split(","),e={GET:1,GETALL:2,CREATE:4,UPDATE:8,DELETE:16},f={CREATE:1,UPDATE:2},g=f.CREATE|f.UPDATE,h=["ngWunderlistConfigurator","ngWunderlistEndpointService",function(a,b){if(!a.getAuthToken()||!a.getClientId())throw new Error("Token and Client ID are needed for the ngWunderlist module to work");var c=this,e=function(a){return a.toString().charAt(0).toUpperCase()+a.toString().slice(1)},f={};return c.getEndpoint=function(a,c){if(d.indexOf(a)===-1)throw new Error("Cannot get endpoint "+a+". Endpoint not implemented.");try{var g=c||!1,h="Endpoint_"+e(a);return f.hasOwnProperty(h)||(f[h]=new b[h](a,g)),f[h]}catch(a){console.error(a)}},c}],i=["ngWunderlistValidation","$http","ngWunderlistConfigurator",function(a,b,d){var h=function(b,f){this.validFields=[],this.endpoint=b,this.identifier=f,this.fieldValidation={},this.endpointData={},this.availableMethods=e.CREATE|e.DELETE|e.UPDATE|e.GET|e.GETALL,this.endpointParams=[],this.config=d.getConfig(),this.list_id=void 0,this.task_id=void 0,this.getConfig=function(){return this.config},this.setId=function(a){return this.identifier=a,this},this.getId=function(){if(this.identifier>0)return this.identifier;throw new Error("Invalid identifier")},this.setData=function(a){return this.endpointData=a,this},this.getData=function(){return this.endpointData},this.setParams=function(a){return this.endpointParams=a,this},this.getParams=function(){return this.endpointParams},this.setEndpoint=function(a){return this.endpoint=a,this},this.getEndpoint=function(){return this.endpoint},this.getListId=function(){var b=this.list_id||this.getParams().list_id;if(!b)throw new Error("List_id is not defined");return(new a.IDNumericValidation).setProperty("list_id").setValue(b).validate(),b},this.setListId=function(a){return this.list_id=a,this},this.getTaskId=function(){var b=this.task_id||this.getParams().task_id;if(!b)throw new Error("Invalid task ID");return(new a.IDNumericValidation).setProperty("list_id").setValue(b).validate(),b},this.setTaskId=function(a){return this.task_id=a,this},this.buildQuery=function(a,b){var c=a+"?",d=[];for(var e in b)b.hasOwnProperty(e)&&d.push(e+"="+b[e]);return c+d.join("&")},this.methodEnabled=function(a){if((this.getAvailableMethods()&a)!==a)throw new Error("Method not available for endpoint "+this.getEndpoint())},this.getAvailableMethods=function(){return this.availableMethods},this.setAvailableMethods=function(a){return this.availableMethods=a,this},this.getValidFields=function(){return this.validFields},this.setValidFields=function(a){return this.validFields=a,this},this.getFieldValidation=function(){return this.fieldValidation},this.setFieldValidation=function(a){return this.fieldValidation=a,this},this.validateScenario=function(a){if((g&a)!==a)throw new Error("Scenario "+a+" is not valid. Valid scenarios are create and update.")},this.validate=function(a){this.prepare(a),this.validateScenario(a);var b=this.getValidFields();if(this.getValidFields().length<=0)throw new Error("The endpoint has no defined valid fields");var c=this.getData();if(Object.keys(c).length<=0)throw new Error("Data cannot be empty");for(var d in c)if(!c.hasOwnProperty(d))throw new Error("Invalid field "+d+". List of available fields are "+b.join(", "));var e=this.getFieldValidation(),f=e[a];if(e.length<=0||f.length<0)throw new Error("Field validation is missing");for(var g in f){if(!f.hasOwnProperty(g))throw new Error("SYSTEM_ERROR field validation for scenario cannot be retrieved");var h=f[g];if(!h.hasOwnProperty("strategy"))throw new Error("SYSTEM_ERROR field validation does not contain a strategy");(new h.strategy).setValue(c[g]).setProperty(g).validate(h.allowEmpty)}this.postValidation(a)},this.execute=function(a,b){var d=e.GET|e.GETALL|e.CREATE|e.UPDATE|e.DELETE;if((d&b)!==b)throw new Error("SYSTEM_ERROR - Invalid method "+b);var f=c+a;switch(this.validateParams(b),b){case e.GET:return this.buildGetUrl(f);case e.GETALL:return this.buildGetAllUrl(f);case e.CREATE:return this.buildPostUrl(f);case e.UPDATE:return this.buildPatchUrl(f);case e.DELETE:return this.buildDeleteUrl(f)}},this.getListOrTask=function(){var a=this.getParams();if(!a.task_id&&!a.list_id)throw new Error("Task ID or List ID is required");return a.task_id?{task_id:a.task_id}:a.list_id?{list_id:a.list_id}:void 0}},i=this;h.prototype.getAll=function(){return this.methodEnabled(e.GETALL),this.execute(this.getEndpoint(),e.GETALL)},h.prototype.get=function(a){return this.methodEnabled(e.GET),a&&this.setId(a),this.execute(this.getEndpoint()+"/"+this.getId(),e.GET)},h.prototype.create=function(a){this.methodEnabled(e.CREATE),a&&this.setData(a);var b=this.getData();if(b.length<=0)throw new Error("Cannot create a new child for "+this.getEndpoint()+" without data");return this.validate(f.CREATE),this.execute(this.getEndpoint(),e.CREATE)},h.prototype.update=function(a){this.methodEnabled(e.UPDATE),a&&this.setData(a);var b=this.getData();if(b.length<=0)throw new Error("Cannot update child of "+this.getEndpoint()+" without data");return this.validate(f.UPDATE),this.execute(this.getEndpoint()+"/"+this.getId(),e.UPDATE)},h.prototype.delete=function(a){this.methodEnabled(e.DELETE),a&&this.setData(a);var b=this.getData();if(!b.revision||1!=Object.keys(b).length)throw new Error("Revision is the only required element to delete a "+this.getEndpoint()+" element");return this.execute(this.buildQuery(this.getEndpoint()+"/"+this.getId(),b),e.DELETE)},h.prototype.buildGetUrl=function(a){return b.get(a,this.getConfig())},h.prototype.buildGetAllUrl=function(a){return this.buildGetUrl(a)},h.prototype.buildPostUrl=function(a){return b.post(a,this.getData(),this.getConfig())},h.prototype.buildPatchUrl=function(a){return b.patch(a,this.getData(),this.getConfig())},h.prototype.buildDeleteUrl=function(a){return b.delete(a,this.getConfig())},h.prototype.postValidation=function(a){},h.prototype.prepare=function(a){},h.prototype.validateParams=function(a){};var j=function(a,b){h.call(this,"previews",b),this.setAvailableMethods(e.GET)},k=function(b,c){h.call(this,b,c),this.setValidFields("title,revision,list_ids".split(","));var d={};d[f.CREATE]={title:{strategy:a.StringValidation},revision:{strategy:a.EmptyRequired},list_ids:{strategy:a.ArrayValidation}},d[f.UPDATE]={title:{strategy:a.StringValidation},revision:{strategy:a.IDNumericValidation},lists_ids:{allowEmpty:!0,strategy:a.ArrayValidation}},this.setFieldValidation(d),this.getFolderRevisions=function(){return this.execute("folder_revisions",e.GET)}},m=function(a,b){h.call(this,a,b),this.setAvailableMethods(e.GET|e.GETALL)},n=function(b,c){h.call(this,b,c),this.setValidFields("title,revision".split(","));var d={};d[f.CREATE]={title:{strategy:a.StringValidation},revision:{strategy:a.EmptyRequired}},d[f.UPDATE]={title:{strategy:a.StringValidation},revision:{strategy:a.IDNumericValidation}},this.setFieldValidation(d),this.tasks=function(){var a=!1;try{a=this.getId()}catch(a){throw new Error("In order to get a task for lists, the list id has to be specified")}return new p("tasks").setParams({list_id:a})}},o=function(b,c){h.call(this,b,c),this.setAvailableMethods(e.GETALL|e.CREATE|e.UPDATE|e.DELETE),this.setValidFields("list_id,user_id,email,muted,state,revision".split(","));var d={};d[f.CREATE]={list_id:{strategy:a.IDNumericValidation},user_id:{allowEmpty:!0,strategy:a.IDNumericValidation},email:{allowEmpty:!0,strategy:a.EmailValidation},revision:{strategy:a.EmptyRequired},muted:{allowEmpty:!0,strategy:a.BooleanValidation},state:{strategy:a.EmptyRequired}},d[f.UPDATE]={revision:{strategy:a.IDNumericValidation},muted:{allowEmpty:!0,strategy:a.BooleanValidation},state:{strategy:a.StringValidation},list_id:{strategy:a.EmptyRequired},user_id:{strategy:a.EmptyRequired},email:{strategy:a.EmptyRequired}},this.setFieldValidation(d)},p=function(b,c){h.call(this,b,c),this.setValidFields("list_id,title,assignee_id,completed,recurrence_type,recurrent_count,due_date,starred,revision,remove".split(","));var d={};d[f.CREATE]={list_id:{strategy:a.IDNumericValidation},title:{strategy:a.StringValidation},assignee_id:{allowEmpty:!0,strategy:a.IDNumericValidation},completed:{allowEmpty:!0,strategy:a.BooleanValidation},recurrence_type:{allowEmpty:!0,strategy:a.StringValidation},recurrence_count:{allowEmpty:!0,strategy:a.IDNumericValidation},due_date:{allowEmpty:!0,strategy:a.DateValidation},starred:{allowEmpty:!0,strategy:a.BooleanValidation},revision:{strategy:a.EmptyRequired},remove:{allowEmpty:!0,strategy:a.ArrayValidation}},d[f.UPDATE]={list_id:{allowEmpty:!0,strategy:a.IDNumericValidation},title:{allowEmpty:!0,strategy:a.StringValidation},assignee_id:{allowEmpty:!0,strategy:a.IDNumericValidation},completed:{allowEmpty:!0,strategy:a.BooleanValidation},recurrence_type:{allowEmpty:!0,strategy:a.StringValidation},recurrence_count:{allowEmpty:!0,strategy:a.IDNumericValidation},due_date:{allowEmpty:!0,strategy:a.DateValidation},starred:{allowEmpty:!0,strategy:a.BooleanValidation},revision:{strategy:a.IDNumericValidation},remove:{allowEmpty:!0," strategy":a.ArrayValidation}},this.setFieldValidation(d),this.notes=function(){var a=!1;try{a=this.getId()}catch(a){throw new Error("In order to get notes, the Task ID has to be specified")}return new q("notes").setParams({task_id:a})}},q=function(b,c){h.call(this,b,c),this.setValidFields("task_id,content,revision".split(","));var d={};d[f.CREATE]={task_id:{strategy:a.IDNumericValidation},content:{strategy:a.StringValidation},revision:{strategy:a.EmptyRequired}},d[f.UPDATE]={task_id:{strategy:a.EmptyRequired},content:{strategy:a.StringValidation},revision:{strategy:a.IDNumericValidation}},this.setFieldValidation(d)},r=function(b,c){h.call(this,!1,c),this.setAvailableMethods(e.GETALL|e.GET|e.UPDATE),this.setValidFields("values,revision".split(","));var d={};d[f.UPDATE]={values:{strategy:a.ArrayValidation},revision:{strategy:a.IDNumericValidation}},this.setFieldValidation(d)},s=function(a,b){r.call(this,a,b),this.setEndpoint("list_positions")},t=function(a,b){r.call(this,a,b),this.setEndpoint("task_positions")},u=function(a,b){r.call(this,a,b),this.setEndpoint("subtask_positions")},v=function(b,c){h.call(this,b,c),this.setValidFields("task_id,date,created_by_device_udid,revision".split(",")),this.setAvailableMethods(e.CREATE|e.UPDATE|e.DELETE|e.GETALL);var d={};d[f.CREATE]={task_id:{strategy:a.IDNumericValidation},date:{strategy:a.DateValidation},created_by_device_udid:{allowEmpty:!0,strategy:a.StringValidation},revision:{strategy:a.EmptyRequired}},d[f.UPDATE]={revision:{strategy:a.IDNumericValidation},date:{strategy:a.DateValidation},created_by_device_udid:{allowEmpty:!0,strategy:a.StringValidation}},this.setFieldValidation(d)},w=function(a,b){h.call(this,a,b),this.setAvailableMethods(e.GET)},x=function(b,c){h.call(this,b,c),this.setValidFields("task_id,title,completed,revision".split(","));var d={};d[f.CREATE]={revision:{strategy:a.EmptyRequired},task_id:{strategy:a.IDNumericValidation},title:{strategy:a.StringValidation},completed:{allowEmpty:!0,strategy:a.BooleanValidation}},d[f.UPDATE]={revision:{strategy:a.IDNumericValidation},title:{strategy:a.StringValidation},completed:{allowEmpty:!0,strategy:a.BooleanValidation}},this.setFieldValidation(d)},y=function(b,c){h.call(this,b,c),this.setValidFields("revision,task_id,text".split(",")),this.setAvailableMethods(e.GET|e.GETALL|e.CREATE|e.DELETE);var d={};d[f.CREATE]={revision:{strategy:a.EmptyRequired},task_id:{strategy:a.IDNumericValidation},text:{strategy:a.StringValidation}},d[f.UPDATE]={revision:{strategy:a.IDNumericValidation},text:{strategy:a.StringValidation}},this.setFieldValidation(d)},z=function(a,b){h.call(this,a,b),this.setAvailableMethods(e.GET)};return l(h,z),l(h,y),l(h,x),l(h,w),l(h,r),l(h,p),l(h,q),l(h,o),l(h,n),l(h,m),l(h,k),l(h,j),l(h,v),l(r,t),l(r,s),l(r,u),j.prototype.validateParams=function(b){var c=this.getParams();switch(b){case e.GET:if(!c.file_id)throw new Error("file_id is needed in file preview");(new a.IDNumericValidation).setProperty("file_id").setValue(c.file_id).validate();var d="mac,web,windows,iphone,ipad,android".split(",");if(d.indexOf(c.platform)===-1)throw new Error("Invalid platform name. Supported elements are: "+d.join(", "));var f="nonretina,retina".split(",");if(f.indexOf(c.size)===-1)throw new Error("Invalid size. Supported sizes are: "+f.join(", "))}},j.prototype.buildGetUrl=function(a){return b.get(this.buildQuery(a,this.getParams()),this.getConfig())},z.prototype.validateParams=function(b){var c=this.getParams();switch(b){case e.GET:if(!c.user_id)throw new Error("User ID is required for avatar endpoint");if((new a.IDNumericValidation).setValue(c.user_id).setProperty("user_id").validate(),c.size){var d="25,28,30,32,50,54,56,60,64,108,128,135,256,270,512".split(",");if(d.indexOf(c.size)==-1)throw new Error("Size attribute is not one of the following: "+d.join(", "))}c.fallback&&(c.fallback=!!c.fallback)}},z.buildGetUrl=function(a){return b.get(this.buildQuery(a,this.getParams()),this.getConfig())},m.prototype.getAll=function(){return this.execute("users",e.GETALL)},m.prototype.get=function(){return this.execute(this.getEndpoint(),e.GET)},o.prototype.postValidation=function(a){var b=this.getData();switch(a){case e.CREATE:if(!b.user_id&&!b.email)throw new Error(this.getEndpoint()+" creation requires either a user_id or email");break;case e.UPDATE:if("accepted"!==b.state)throw new Error(this.getEndpoint()+" update requires state to be accepted")}},p.prototype.postValidation=function(){var a=this.getData(),b=a.recurrence_type,c=a.recurrence_count;if(b||c){if(!b||!c)throw new Error(this.getEndpoint()+" recurrence type and recurrence count need to be present at the same time");var d="day,week,month,year".split(",");if(d.indexOf(b)===-1)throw new Error(this.getEndpoint()+" recurrence type needs does not match any valid option ["+d.join(", ")+"]")}},p.prototype.validateParams=function(a){if(a===e.GETALL){var b=this.getParams();if(!b.list_id)throw new Error("List ID is needed to get Tasks");b.completed&&(b.completed=!!b.completed)}},p.prototype.buildGetAllUrl=function(a){return b.get(this.buildQuery(a,this.getParams()),this.getConfig())},p.prototype.prepare=function(a){var b=this.getData();(f.CREATE&a)!==a||b.list_id||(b.list_id=this.getTaskId(),this.setData(b))},p.prototype.buildPostUrl=function(a){return b.post(this.buildQuery(a,{list_id:this.getListId()}),this.getData(),this.getConfig())},q.prototype.validateParams=function(a){if(a===e.GETALL){var b=this.getParams();if(!b.task_id)throw new Error("Task ID is required to retrieve Notes")}},q.prototype.buildGetAllUrl=function(a){return b.get(this.buildQuery(a,this.getParams()),this.getConfig())},q.prototype.prepare=function(a){var b=this.getData();(f.CREATE&a)!==a||b.task_id||(b.task_id=this.getTaskId(),this.setData(b))},r.prototype.prepare=function(){if(!this.getEndpoint())throw new Error("Endpoint is null, the Positions endpoint needs to be called as list_positions, task_positions, or subtask_positions")},t.prototype.validateParams=function(a){if(a===e.GETALL){var b=this.getParams();if(!b.list_id)throw new Error("List ID is required to retrieve task positions")}},t.prototype.buildGetAllUrl=function(a){return b.get(this.buildQuery(a,this.getParams()),this.getConfig())},u.prototype.validateParams=function(a){if(a===e.GETALL){var b=this.getListOrTask();this.setParams(b)}},u.prototype.buildGetAllUrl=function(a){return b.get(this.buildQuery(a,this.getParams()),this.getConfig())},v.prototype.validateParams=function(a){if(a===e.GETALL){var b=this.getListOrTask();this.setParams(b)}},v.prototype.buildGetAllUrl=function(a){return b.get(this.buildQuery(a,this.getParams()),this.getConfig())},v.prototype.prepare=function(a){var b=this.getData();(f.CREATE&a)!==a||b.task_id||(b.task_id=this.getTaskId(),this.setData(b))},w.prototype.get=function(){return this.execute(this.getEndpoint(),e.GET)},x.prototype.prepare=function(a){var b=this.getData();(f.CREATE&a)!==a||b.task_id||(b.task_id=this.getTaskId(),this.setData(b))},x.prototype.validateParams=function(a){if(a===e.GETALL){var b=this.getListOrTask(),c=this.getParams();c.completed&&(b.completed=!!c.completed),this.setParams(b)}},x.prototype.buildGetAllUrl=function(a){return b.get(this.buildQuery(a,this.getParams()),this.getConfig())},y.prototype.prepare=function(a){var b=this.getData();(f.CREATE&a)!==a||b.task_id||(b.task_id=this.getTaskId(),this.setData(b))},y.prototype.validateParams=function(a){if(a===e.GETALL){var b=this.getListOrTask();this.setParams(b)}},y.prototype.buildGetAllUrl=function(a){return b.get(this.buildQuery(a,this.getParams()),this.getConfig())},i.Endpoint_Avatar=z,i.Endpoint_Task_comments=y,i.Endpoint_Subtasks=x,i.Endpoint_Root=w,i.Endpoint_Positions=r,i.Endpoint_Tasks=p,i.Endpoint_Notes=q,i.Endpoint_Memberships=o,i.Endpoint_Lists=n,i.Endpoint_User=m,i.Endpoint_Folders=k,i.Endpoint_Filepreview=j,i.Endpoint_Reminders=v,i.Endpoint_Task_positions=t,i.Endpoint_List_positions=s,i.Endpoint_Subtask_positions=u,i}],j=function(){var a=function(a,b){this.name=a,this.variableType=b,this.validateType=!0,this.property=void 0,this.value=void 0,this.allowEmpty=!1,this.setName=function(a){return this.name=a,this},this.getName=function(){return this.name},this.setValue=function(a){return this.value=a,this},this.setProperty=function(a){return this.property=a,this},this.getProperty=function(){return this.property},this.getValue=function(){return this.value},this.getVariableType=function(){return this.variableType},this.setAllowEmpty=function(a){this.allowEmpty=!!a},this.getAllowEmpty=function(){return this.allowEmpty},this.setValidateType=function(a){this.validateType=!!a},this.getValidateType=function(){return this.validateType},this.validate=function(a){a&&this.allowEmpty(!!a),this.getValidateType()&&typeof this.getValue()!=this.getVariableType()&&"undefined"!=typeof this.getValue()&&this.typeError(),this.validationFunction()},this.error=function(a){throw new Error(this.getName()+" validation error. "+this.getProperty()+" "+a)},this.typeError=function(){throw new Error(this.getProperty()+" is not of type "+this.getVariableType())}};a.prototype.validationFunction=function(){throw new Error("Validation function not defined")};var b=this,c=function(){a.call(this,"Numeric","number")},d=function(){a.call(this,"String","string")},e=function(){a.call(this,"EmptyRequired","object"),this.setValidateType(!1)},f=function(){a.call(this,"EmailValidation","string")},g=function(){a.call(this,"ArrayValidation","array"),this.setValidateType(!1)},h=function(){a.call(this,"BooleanValidation","boolean")},i=function(){a.call(this,"DateValidation","string")};return l(a,g),l(a,d),l(a,h),l(a,e),l(a,f),l(a,c),l(a,i),c.prototype.validationFunction=function(){var a=this.getValue();this.getAllowEmpty()||a||this.error("is empty"),a&&0>=a&&this.error("has to be greater than 0")},d.prototype.validationFunction=function(){var a=this.getValue();""!==a||this.getAllowEmpty()||this.error("cannot be empty"),a&&a.length>255&&this.error("cannot exceed 255 characters")},e.prototype.validationFunction=function(){"undefined"!=typeof this.getValue()&&this.error("needs to be empty")},f.prototype.validationFunction=function(){var a=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,b=this.getValue();this.getAllowEmpty()||b||this.error("cannot be empty"),b&&!a.test(b)&&this.error("is not a valid email")},g.prototype.validationFunction=function(){var a=this.getValue();!this.getAllowEmpty()&&a.length<0&&this.error("cannot be empty"),!Array.isArray(a)&&a>0&&this.error("is not an Array")},h.prototype.validationFunction=function(){var a=this.getValue();this.getAllowEmpty()||a||this.error("cannot be empty"),a&&!!a!=a&&this.error("is not a valid boolean field")},i.prototype.validationFunction=function(){var a=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,b=this.getValue();this.getAllowEmpty()||b||this.error("cannot be empty"),b&&!a.test(b)&&this.error("is not a valid ISO 8601 date.")},b.IDNumericValidation=c,b.StringValidation=d,b.EmptyRequired=e,b.EmailValidation=f,b.ArrayValidation=g,b.BooleanValidation=h,b.DateValidation=i,b},k=function(){var a="",b="";return{setClientId:function(b){a=b},getClientId:function(){return a},setAuthToken:function(a){b=a},getAuthToken:function(){return b},getConfig:function(){return{headers:{"X-Access-Token":b,"X-Client-ID":a}}},$get:function(){return this}}};b.service("ngWunderlistService",h),b.service("ngWunderlistEndpointService",i),b.service("ngWunderlistValidation",j),b.provider("ngWunderlistConfigurator",k)}(angular);